{% extends 'index.html'%}
{% block title %}Dashboard - PhishSnitch{% endblock title%}
{% block content %}
<style>
    body {
        background-color: #1b1f29;
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
        color: #f1f3f5;
        border: 1px solid rgba(255, 255, 255, 0.125);
    }

    .glass-card .card-body {
        padding: 1.5rem;
    }

    .glass-table {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    }

    .glass-table th, .glass-table td {
        color: #f8f9fa;
        background-color: transparent !important;
    }

    .glass-table thead th {
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .glass-table tbody tr.table-light {
        background-color: rgba(255, 255, 255, 0.1) !important;
    }

    .glass-table tbody tr.table-active {
        background-color: rgba(255, 255, 255, 0.05) !important;
    }

    .display-4 {
        color: #5fd3f3;
        text-shadow: 0 0 10px rgba(95, 211, 243, 0.5);
    }

    .badge.bg-primary {
        background-color: #5fd3f3 !important;
        color: black;
    }

    .card-text {
        font-size: 1.1rem;
    }
</style>

<h1 class="display-4 text-center my-5">Dashboard</h1>

<div class="container">
    <div class="row">
        {% for card in [
            {'count': total_users, 'label': 'Active Users', 'today': today_users, 'gain': gain_users},
            {'count': total_quizzes, 'label': 'Quizzes', 'today': today_quizzes, 'gain': gain_quizzes},
            {'count': total_quiz_submit, 'label': 'Submissions', 'today': today_quiz_submit, 'gain': gain_quiz_submit},
            {'count': total_questions, 'label': 'Questions', 'today': today_questions, 'gain': gain_questions},
        ] %}
        <div class="col-sm-6 col-lg-3 mb-4">
            <div class="card glass-card h-100">
                <div class="card-body text-center mt-3">
                    <h1 class="card-title pricing-card-title">{{ card.count }}</h1>
                    <p class="card-text">{{ card.label }}</p>
                    <ul class="list-group mt-4">
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-0">
                            Today
                            <span class="badge bg-primary rounded-pill">{{ card.today }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-0">
                            Gain %
                            <span class="badge bg-primary rounded-pill">{{ card.gain|default:0 }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="row">
        <div class="col-12 mb-5">
            <h2 class="text-center text-light my-4">Inbox</h2>
            <div class="glass-table p-3">
                <table class="table mb-0">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>User</th>
                            <th>Subject</th>
                            <th>Time</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for message in messages %}
                        <tr class="{% if not message.is_read %}table-light{% else %}table-active{% endif %}">
                            <th scope="row">{{ forloop.counter }}</th>
                            <td><a class="text-decoration-none text-info" href="{% url 'profile' message.user.username %}">{{ message.user.username }}</a></td>
                            <td>{{ message.subject }}</td>
                            <td>{{ message.created_at }}</td>
                            <td><a href="{% url 'message' message.id %}" class="btn btn-sm btn-outline-light">Open</a></td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="5" class="text-center text-light">No messages available.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
